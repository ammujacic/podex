appId: com.podex.desktop
productName: Podex
copyright: Copyright Â© 2024 Podex

directories:
  output: release
  buildResources: resources

files:
  - dist/**/*
  - package.json

extraResources:
  - from: resources/
    to: ./
    filter:
      - "**/*"

# ============================================
# Deep Linking Protocol
# ============================================
protocols:
  - name: Podex
    schemes:
      - podex

# ============================================
# macOS Configuration
# ============================================
mac:
  category: public.app-category.developer-tools
  target:
    - target: dmg
      arch:
        - x64
        - arm64
    - target: zip
      arch:
        - x64
        - arm64
  darkModeSupport: true
  hardenedRuntime: true
  gatekeeperAssess: false

  # Code Signing - set these environment variables for signing:
  # CSC_LINK: path to .p12 certificate file or base64 encoded
  # CSC_KEY_PASSWORD: certificate password
  # Or for keychain:
  # CSC_NAME: certificate name in keychain
  entitlements: resources/entitlements.mac.plist
  entitlementsInherit: resources/entitlements.mac.plist

  # Notarization - set these environment variables:
  # APPLE_ID: your Apple ID
  # APPLE_APP_SPECIFIC_PASSWORD: app-specific password
  # APPLE_TEAM_ID: your team ID
  notarize: false  # Set to true when ready to notarize

dmg:
  sign: false  # Set to true for production
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications

# ============================================
# Windows Configuration
# ============================================
win:
  target:
    - target: nsis
      arch:
        - x64
        - arm64
    - target: portable
      arch:
        - x64

  # Code Signing - set these environment variables:
  # WIN_CSC_LINK: path to .pfx certificate file
  # WIN_CSC_KEY_PASSWORD: certificate password
  # Or for EV certificates (requires hardware token):
  # CSC_LINK and CSC_KEY_PASSWORD

  # For Azure SignTool (recommended for EV certs):
  # AZURE_KEY_VAULT_URI
  # AZURE_KEY_VAULT_CLIENT_ID
  # AZURE_KEY_VAULT_CLIENT_SECRET
  # AZURE_KEY_VAULT_CERTIFICATE_NAME
  # AZURE_KEY_VAULT_TENANT_ID

  signingHashAlgorithms:
    - sha256

  # Request admin elevation for file associations
  requestedExecutionLevel: asInvoker

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: Podex

  # Include uninstaller
  include: resources/installer.nsh

# ============================================
# Linux Configuration
# ============================================
linux:
  target:
    - target: AppImage
      arch:
        - x64
        - arm64
    - target: deb
      arch:
        - x64
    - target: rpm
      arch:
        - x64
  category: Development
  maintainer: Podex Team <team@podex.dev>
  vendor: Podex
  synopsis: AI-powered development workspace
  description: Podex is an AI-powered development workspace that helps you code faster with intelligent agents.

  # Desktop file
  desktop:
    StartupWMClass: podex
    MimeType: x-scheme-handler/podex

# ============================================
# Auto Update Configuration
# ============================================
publish:
  # GitHub Releases (recommended for open source)
  - provider: github
    owner: your-org
    repo: podex
    releaseType: release

  # Or use a generic server
  # - provider: generic
  #   url: https://releases.podex.dev
  #   useMultipleRangeRequest: false

# ============================================
# Build Options
# ============================================
compression: normal
asar: true
asarUnpack:
  - "**/*.node"
  - "**/node_modules/@sentry/**"

# Remove source maps in production
removePackageScripts: true

# Electron download mirror (for faster builds in certain regions)
# electronDownload:
#   mirror: https://npmmirror.com/mirrors/electron/

# Build metadata
buildVersion: ${env.BUILD_NUMBER}
